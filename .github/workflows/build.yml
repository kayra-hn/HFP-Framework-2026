name: Build HFP
on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: pip install numpy scipy matplotlib pandas
    
    - name: Find HFP Python files
      id: find-files
      run: |
        echo "Mevcut Python dosyalarÄ±:"
        find . -name "*.py" -type f | grep -v __pycache__ | head -20
        
        # HFP kodunu iÃ§eren dosyayÄ± bul
        for file in $(find . -name "*.py" -type f); do
          if grep -l "class HFP_Parameters" "$file" 2>/dev/null; then
            echo "HFP dosyasÄ± bulundu: $file"
            echo "hfp_file=$file" >> $GITHUB_OUTPUT
          fi
        done
        
        # Alternatif arama
        for file in $(find . -name "*.py" -type f); do
          if grep -l "Hubble_HFP\|HFP.*Parameters" "$file" 2>/dev/null; then
            echo "Potansiyel HFP dosyasÄ±: $file"
            echo "potential_file=$file" >> $GITHUB_OUTPUT
          fi
        done
    
    - name: Run HFP model with dynamic import
      run: |
        # Ã–nce dosya adÄ±nÄ± bul
        HFP_FILE=""
        
        # 1. HFP_Parameters iÃ§eren dosyayÄ± ara
        for file in $(find . -name "*.py" -type f); do
          if grep -q "class HFP_Parameters" "$file"; then
            HFP_FILE="$file"
            break
          fi
        done
        
        # 2. Bulamazsan Hubble_HFP ara
        if [ -z "$HFP_FILE" ]; then
          for file in $(find . -name "*.py" -type f); do
            if grep -q "def Hubble_HFP" "$file"; then
              HFP_FILE="$file"
              break
            fi
          done
        fi
        
        # 3. Hala bulamazsan ilk .py dosyasÄ±nÄ± al
        if [ -z "$HFP_FILE" ]; then
          HFP_FILE=$(find . -name "*.py" -type f | head -1)
        fi
        
        if [ -z "$HFP_FILE" ]; then
          echo "âŒ HiÃ§ Python dosyasÄ± bulunamadÄ±!"
          exit 1
        fi
        
        echo "ğŸ“ KullanÄ±lacak dosya: $HFP_FILE"
        echo "Dosya iÃ§eriÄŸinin ilk 5 satÄ±rÄ±:"
        head -5 "$HFP_FILE"
        
        # Dinamik import yap
        python -c "
import sys
import os
import importlib.util

print('Python versiyonu:', sys.version)
print('Ã‡alÄ±ÅŸma dizini:', os.getcwd())

try:
    # Dosya adÄ±nÄ± al
    file_path = '$HFP_FILE'
    
    if not os.path.exists(file_path):
        print(f'Dosya bulunamadÄ±: {file_path}')
        exit(1)
    
    print(f'Import edilecek dosya: {file_path}')
    
    # Dinamik import
    spec = importlib.util.spec_from_file_location('hfp_module', file_path)
    module = importlib.util.module_from_spec(spec)
    spec.loader.exec_module(module)
    
    print('âœ“ ModÃ¼l baÅŸarÄ±yla yÃ¼klendi')
    
    # Hangi sÄ±nÄ±flar/fonksiyonlar var?
    print('\\nModÃ¼ldeki Ã¶ÄŸeler:')
    for item in dir(module):
        if not item.startswith('_'):
            print(f'  - {item}')
    
    # HFP_Parameters'Ä± dene
    if hasattr(module, 'HFP_Parameters'):
        params = module.HFP_Parameters()
        print(f'âœ“ HFP_Parameters oluÅŸturuldu')
        
        # Hubble_HFP'yi dene
        if hasattr(module, 'Hubble_HFP'):
            H = module.Hubble_HFP(1.0, params)
            print(f'âœ“ Hubble_HFP Ã§alÄ±ÅŸtÄ±: H(1.0) = {H:.2f}')
        else:
            print('âš  Hubble_HFP fonksiyonu bulunamadÄ±')
            
    else:
        print('âš  HFP_Parameters sÄ±nÄ±fÄ± bulunamadÄ±')
        
    print('\\nâœ… HFP testi tamamlandÄ±')
    
except Exception as e:
    print(f'âŒ Hata: {e}')
    import traceback
    traceback.print_exc()
    exit(1)
"
